<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stanbic Admin</title>

<style>
body{
  font-family:'Segoe UI', Arial, sans-serif;
  background:#f0f2f5;
  margin:0;
}
.container{
  max-width:900px;
  margin:auto;
  padding:20px;
}
.card{
  background:white;
  padding:20px;
  border-radius:12px;
  margin-bottom:15px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}
h3{
  margin:0 0 10px 0;
  font-size:20px;
}
input, select, button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
  box-sizing:border-box;
}
button{
  cursor:pointer;
  font-weight:600;
  transition:0.2s;
}
button:hover{
  opacity:0.9;
}
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
}
#dashboard{display:none;}
#stats{
  font-size:14px;
  margin-bottom:10px;
  font-weight:600;
}
.codeCard{
  background:#fdfdfd;
  padding:12px;
  border-radius:10px;
  margin-top:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.06);
  font-size:13px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
}
.codeInfo{
  flex:1 1 60%;
}
.codeButtons{
  flex:1 1 35%;
  display:flex;
  gap:5px;
  justify-content:flex-end;
  flex-wrap:wrap;
}
.generateBtn{background:linear-gradient(90deg,#1c2c8c,#3a49c5);color:white;border:none;}
.deleteBtn{background:#ff4d4d;color:white;border:none;}
.revokeBtn{background:#ff9800;color:white;border:none;}
.copyBtn{background:#4caf50;color:white;border:none;}
input:focus, select:focus{outline:none;border-color:#3a49c5;box-shadow:0 0 5px rgba(58,73,197,0.3);}
</style>
</head>

<body>

<div class="container">

<div class="card" id="loginBox">
<h3>Admin Login</h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<div id="dashboard">

<div class="card topbar">
<h3>Admin Dashboard</h3>
<button onclick="logout()" style="background:#ff4d4d;color:white;border:none;padding:10px 20px;border-radius:8px">Logout</button>
</div>

<div class="card">
<button class="generateBtn" onclick="generateCode()">Generate New Code</button>
</div>

<div class="card">
<input id="search" placeholder="Search code..." oninput="loadCodes()">
<select id="filter" onchange="loadCodes()">
<option value="all">All</option>
<option value="active">Active</option>
<option value="used">Used</option>
<option value="expired">Expired</option>
</select>

<div id="stats"></div>
<div id="codes"></div>
</div>

</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
getFirestore, collection, addDoc, getDocs,
updateDoc, deleteDoc, doc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

import {
getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
apiKey: "AIzaSyBCXfc6oFNUkx1qLWZt5ZqpY2yYzn0OTio",
authDomain: "stanbic-pro.firebaseapp.com",
projectId: "stanbic-pro",
storageBucket: "stanbic-pro.firebasestorage.app",
messagingSenderId: "430146762267",
appId: "1:430146762267:web:7653262e8cba7c1cc02abe"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

onAuthStateChanged(auth,user=>{
if(user){
loginBox.style.display="none";
dashboard.style.display="block";
loadCodes();
}else{
loginBox.style.display="block";
dashboard.style.display="none";
}
});

window.login=()=>signInWithEmailAndPassword(auth,email.value,password.value);
window.logout=()=>signOut(auth);

window.generateCode=async()=>{
const newCode="PRO-"+Math.random().toString(36).substr(2,8).toUpperCase();
await addDoc(collection(db,"accessCodes"),{
code:newCode, used:false, device:"", expires:Date.now()+30*24*60*60*1000, created:serverTimestamp()
});
loadCodes();
};

async function loadCodes(){
const snap=await getDocs(collection(db,"accessCodes"));
let search=search.value.toLowerCase();
let filter=filter.value;
let total=0,active=0,used=0,expired=0;
let html="";

snap.forEach(docu=>{
const d=docu.data();
const id=docu.id;
const now=Date.now();
let status="active";
if(now>d.expires){status="expired";expired++;}
else if(d.used){status="used";used++;}
else{active++;}
total++;
if(filter!=="all" && filter!==status) return;
if(!d.code.toLowerCase().includes(search)) return;

html+=`
<div class="codeCard">
<div class="codeInfo">
<b>${d.code}</b><br>
Status: ${status}<br>
Expires: ${new Date(d.expires).toLocaleDateString()}<br>
${d.device?`Device: ${d.device}<br>`:""}
</div>
<div class="codeButtons">
<button class="copyBtn" onclick="copyCode('${d.code}')">Copy</button>
<button class="revokeBtn" onclick="revoke('${id}')">Revoke</button>
<button class="deleteBtn" onclick="del('${id}')">Delete</button>
</div>
</div>
`;
});

stats.innerHTML=`Total: ${total} | Active: ${active} | Used: ${used} | Expired: ${expired}`;
codes.innerHTML=html;
}

window.copyCode=code=>navigator.clipboard.writeText(code);
window.revoke=async id=>{
await updateDoc(doc(db,"accessCodes",id),{used:false,device:""});
loadCodes();
};
window.del=async id=>{
if(confirm("Delete code?")){
await deleteDoc(doc(db,"accessCodes",id));
loadCodes();
}
};

</script>
</body>
</html>